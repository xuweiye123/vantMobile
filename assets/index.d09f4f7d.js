import{d as e,j as a,n as t,h as r,g as l,i as s,C as n,o,D as i,p as u,m as c,y as d,a as m,O as g,B as p,c as f,q as v,w as b,b as h,e as y,f as w,s as x,t as k,M as V}from"./index.bf5caa1b.js";import{c as S,n as B,t as C,w as M,l as T,b as A,x as I,m as P,o as j,e as E,u as L,f as $,i as _,y as F,I as z,v as W,_ as q}from"./plugin-vueexport-helper.a4f4c37e.js";import{b as O,p as D,f as H,s as U,r as K,h as G,u as J}from"./useLoading.05267857.js";import{B as N}from"./index.47ba3fb7.js";import{c as Q,C as R}from"./index.1ab5de04.js";import{b as X,F as Y,e as Z,C as ee}from"./constant.ffa4f438.js";import"./use-route.43404921.js";const[ae,te]=S("form");const re=M(e({name:ae,props:{colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:B,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:C,showErrorMessage:C,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}},emits:["submit","failed"],setup(e,{emit:t,slots:r}){const{children:l,linkChildren:s}=X(Y),n=e=>e?l.filter((a=>e.includes(a.name))):l,o=a=>{return"string"==typeof a?(e=>{const a=l.find((a=>a.name===e));return a?new Promise(((e,t)=>{a.validate().then((a=>{a?t(a):e()}))})):Promise.reject()})(a):e.validateFirst?(t=a,new Promise(((e,a)=>{const r=[];n(t).reduce(((e,a)=>e.then((()=>{if(!r.length)return a.validate().then((e=>{e&&r.push(e)}))}))),Promise.resolve()).then((()=>{r.length?a(r):e()}))}))):(e=>new Promise(((a,t)=>{const r=n(e);Promise.all(r.map((e=>e.validate()))).then((e=>{(e=e.filter(Boolean)).length?t(e):a()}))})))(a);var t},i=(e,a)=>{l.some((t=>t.name===e&&(t.$el.scrollIntoView(a),!0)))},u=()=>l.reduce(((e,a)=>(e[a.name]=a.formValue.value,e)),{}),c=()=>{const a=u();o().then((()=>t("submit",a))).catch((r=>{t("failed",{values:a,errors:r}),e.scrollToError&&r[0].name&&i(r[0].name)}))},d=e=>{D(e),c()};return s({props:e}),O({submit:c,validate:o,getValues:u,scrollToField:i,resetValidation:e=>{"string"==typeof e&&(e=[e]);n(e).forEach((e=>{e.resetValidation()}))},getValidationStatus:()=>l.reduce(((e,a)=>(e[a.name]=a.getValidationStatus(),e)),{})}),()=>{var e;return a("form",{class:te(),onSubmit:d},[null==(e=r.default)?void 0:e.call(r)])}}}));function le(e,a){return(!a.required||!function(e){return Array.isArray(e)?!e.length:0!==e&&!e}(e))&&!(a.pattern&&!a.pattern.test(String(e)))}function se(e,a){const{message:t}=a;return I(t)?t(e,a):t||""}function ne({target:e}){e.composing=!0}function oe({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function ie(e){return[...e].length}let ue=0;const[ce,de]=S("field");const me=M(e({name:ce,props:E({},Q,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:B,formatter:Function,clearIcon:P("clear"),modelValue:j(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:P("focus"),formatTrigger:P("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:B,type:P("text"),rules:Array,autosize:[Boolean,Object],labelWidth:B,labelClass:L,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","click-input","end-validate","start-validate","click-left-icon","click-right-icon","update:modelValue"],setup(e,{emit:m,slots:g}){const p=function(){const e=t(),{name:a="unknown"}=(null==e?void 0:e.type)||{};return`${a}-${++ue}`}(),f=r({status:"unvalidated",focused:!1,validateMessage:""}),v=l(),b=l(),{parent:h}=Z(Y),y=()=>{var a;return String(null!=(a=e.modelValue)?a:"")},w=a=>_(e[a])?e[a]:h&&_(h.props[a])?h.props[a]:void 0,x=s((()=>{const a=w("readonly");if(e.clearable&&!a){const a=""!==y(),t="always"===e.clearTrigger||"focus"===e.clearTrigger&&f.focused;return a&&t}return!1})),k=s((()=>b.value&&g.input?b.value():e.modelValue)),V=e=>e.reduce(((e,a)=>e.then((()=>{if("failed"===f.status)return;let{value:e}=k;return a.formatter&&(e=a.formatter(e,a)),le(e,a)?a.validator?function(e,a){return new Promise((t=>{const r=a.validator(e,a);A(r)?r.then(t):t(r)}))}(e,a).then((t=>{t&&"string"==typeof t?(f.status="failed",f.validateMessage=t):!1===t&&(f.status="failed",f.validateMessage=se(e,a))})):void 0:(f.status="failed",void(f.validateMessage=se(e,a)))}))),Promise.resolve()),S=()=>{f.status="unvalidated",f.validateMessage=""},B=()=>m("end-validate",{status:f.status}),C=(a=e.rules)=>new Promise((t=>{S(),a?(m("start-validate"),V(a).then((()=>{"failed"===f.status?(t({name:e.name,message:f.validateMessage}),B()):(f.status="passed",t(),B())}))):t()})),M=a=>{if(h&&e.rules){const{validateTrigger:t}=h.props,r=W(t).includes(a),l=e.rules.filter((e=>e.trigger?W(e.trigger).includes(a):r));l.length&&C(l)}},I=(a,t="onChange")=>{if(a=(a=>{const{maxlength:t}=e;if(_(t)&&ie(a)>t){const e=y();return e&&ie(e)===+t?e:function(e,a){return[...e].slice(0,a).join("")}(a,+t)}return a})(a),"number"===e.type||"digit"===e.type){const t="number"===e.type;a=F(a,t,t)}e.formatter&&t===e.formatTrigger&&(a=e.formatter(a)),v.value&&v.value.value!==a&&(v.value.value=a),a!==e.modelValue&&m("update:modelValue",a)},P=e=>{e.target.composing||I(e.target.value)},j=()=>{var e;return null==(e=v.value)?void 0:e.blur()},E=()=>{const a=v.value;"textarea"===e.type&&e.autosize&&a&&function(e,a){const t=H();e.style.height="auto";let r=e.scrollHeight;if(T(a)){const{maxHeight:e,minHeight:t}=a;void 0!==e&&(r=Math.min(r,e)),void 0!==t&&(r=Math.max(r,t))}r&&(e.style.height=`${r}px`,U(t))}(a,e.autosize)},L=e=>{f.focused=!0,m("focus",e),i(E),w("readonly")&&j()},q=e=>{w("readonly")||(f.focused=!1,I(y(),"onBlur"),m("blur",e),M("onBlur"),i(E),K())},G=e=>m("click-input",e),J=e=>m("click-left-icon",e),N=e=>m("click-right-icon",e),Q=e=>{D(e),m("update:modelValue",""),m("clear",e)},X=s((()=>"boolean"==typeof e.error?e.error:!(!h||!h.props.showError||"failed"!==f.status)||void 0)),ae=s((()=>{const e=w("labelWidth");if(e)return{width:$(e)}})),te=a=>{if(13===a.keyCode){h&&h.props.submitOnEnter||"textarea"===e.type||D(a),"search"===e.type&&j()}m("keypress",a)},re=()=>e.id||`${p}-input`,ce=()=>{const t=de("control",[w("inputAlign"),{error:X.value,custom:!!g.input,"min-height":"textarea"===e.type&&!e.autosize}]);if(g.input)return a("div",{class:t,onClick:G},[g.input()]);const r={id:re(),ref:v,name:e.name,rows:void 0!==e.rows?+e.rows:void 0,class:t,disabled:w("disabled"),readonly:w("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${p}-label`:void 0,onBlur:q,onFocus:L,onInput:P,onClick:G,onChange:oe,onKeypress:te,onCompositionend:oe,onCompositionstart:ne};return"textarea"===e.type?a("textarea",r,null):a("input",c("number"===(l=e.type)?{type:"text",inputmode:"decimal"}:"digit"===l?{type:"tel",inputmode:"numeric"}:{type:l},r),null);var l},me=()=>{const t=g["right-icon"];if(e.rightIcon||t)return a("div",{class:de("right-icon"),onClick:N},[t?t():a(z,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},ge=()=>{if(e.showWordLimit&&e.maxlength){const t=ie(y());return a("div",{class:de("word-limit")},[a("span",{class:de("word-num")},[t]),d("/"),e.maxlength])}},pe=()=>{if(h&&!1===h.props.showErrorMessage)return;const t=e.errorMessage||f.validateMessage;if(t){const e=g["error-message"],r=w("errorMessageAlign");return a("div",{class:de("error-message",r)},[e?e({message:t}):t])}},fe=()=>[a("div",{class:de("body")},[ce(),x.value&&a(z,{name:e.clearIcon,class:de("clear"),onTouchstart:Q},null),me(),g.button&&a("div",{class:de("button")},[g.button()])]),ge(),pe()];return O({blur:j,focus:()=>{var e;return null==(e=v.value)?void 0:e.focus()},validate:C,formValue:k,resetValidation:S,getValidationStatus:()=>f.status}),u(ee,{customValue:b,resetValidation:S,validateWithTrigger:M}),n((()=>e.modelValue),(()=>{I(y()),S(),M("onChange"),i(E)})),o((()=>{I(y(),e.formatTrigger),i(E)})),()=>{const t=w("disabled"),r=w("labelAlign"),l=(()=>{const t=w("colon")?":":"";return g.label?[g.label(),t]:e.label?a("label",{id:`${p}-label`,for:re()},[e.label+t]):void 0})(),s=(()=>{const t=g["left-icon"];if(e.leftIcon||t)return a("div",{class:de("left-icon"),onClick:J},[t?t():a(z,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return a(R,{size:e.size,icon:e.leftIcon,class:de({error:X.value,disabled:t,[`label-${r}`]:r}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:ae.value,valueClass:de("value"),titleClass:[de("label",[r,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:s?()=>s:null,title:l?()=>l:null,value:fe,extra:g.extra})}}})),ge={login:async e=>await G.post("/user/login",e)},pe={class:"login"},fe={class:"content"},ve=(e=>(x("data-v-9b118154"),e=e(),k(),e))((()=>v("div",{class:"logo"},[v("img",{src:"/vantMobile/assets/vue.5532db34.svg",alt:"logo"})],-1))),be=d("Login "),he=q(e({__name:"index",setup(e){const t=V(),s=h(),{startLoading:n,stopLoading:i}=J(),u=l("password"),c=l(!1),d=r({username:"",password:""});o((()=>{m.config(s.query.debug),g.enable()})),p((()=>{g.disable()}));const x=()=>{c.value=!c.value,u.value=c.value?"text":"password"},k=async()=>{setTimeout((()=>{t.push("/index")}),3e3),n(),await ge.login(d),i(),t.push("/index")},S=(e={})=>{};return(e,t)=>{const r=me,l=z,s=N,n=re;return y(),f("div",pe,[v("div",fe,[ve,a(n,{onSubmit:k,onFailed:S},{default:b((()=>[a(r,{modelValue:d.username,"onUpdate:modelValue":t[0]||(t[0]=e=>d.username=e),modelModifiers:{trim:!0},name:"username",clearable:"",placeholder:"input username"},null,8,["modelValue"]),a(r,{modelValue:d.password,"onUpdate:modelValue":t[1]||(t[1]=e=>d.password=e),type:u.value,name:"password",clearable:"",placeholder:"input password"},{button:b((()=>[v("div",{onClick:x},[c.value?(y(),w(l,{key:0,name:"eye-o"})):(y(),w(l,{key:1,name:"closed-eye"}))])])),_:1},8,["modelValue","type"]),a(s,{block:"",type:"primary","native-type":"submit",class:"submit-btn"},{default:b((()=>[be])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-9b118154"]]);export{he as default};
