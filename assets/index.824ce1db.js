import{d as e,h as t,o as s,c as a,q as o,j as i,w as n,F as r,r as d,n as l,s as u,t as c,e as f,v as m,x as p,f as _,y as w,z as v}from"./index.5befa41d.js";import{U as g,R as b,C as x,A as y}from"./index.0b9e3de9.js";import{u as k,T as h}from"./useLoading.e2b30ee2.js";import{B as j}from"./index.66c605da.js";import{_ as L}from"./plugin-vueexport-helper.d94c3bb6.js";import"./constant.756902f2.js";import"./use-route.2fdc255c.js";const I=e=>(u("data-v-64eeab88"),e=e(),c(),e),z={class:"identityCard"},$={class:"fontS"},C=I((()=>o("span",null,"请上传您的身份证人像面",-1))),O={src:"https://img1.baidu.com/it/u=4603732,1550247081&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800",alt:"",style:{width:"300px",height:"200px","border-radius":"10px"}},U={class:"fontS"},V=I((()=>o("span",null,"请上传您的身份证国徽面",-1))),A={src:"https://img1.baidu.com/it/u=4214905558,1464297231&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800",alt:"",style:{width:"300px",height:"200px","border-radius":"10px"}},P=w("人脸认证"),R=L(e({__name:"index",setup(e){const u=t({name:"identityCard",fileListzm:[],fileListfm:[],url:"",dataObj:{words_result_num:0,words_result:{"姓名":{words:""},"公民身份号码":{words:""}}},infoList:[]});s((()=>{u.url=window.location.origin}));const{startLoading:c,stopLoading:L}=k(),I=t({access_token:"",id_card_side:"",image:"",detect_risk:!0,detect_quality:!0}),{proxy:R}=l(),T=t({grant_type:R.$dataInfo.grant_type,client_id:R.$dataInfo.client_id,client_secret:R.$dataInfo.client_secret}),q=async(e,t)=>{if(c(),I.id_card_side=e,I.image=t,!I.access_token){const e=await y.getAccessTokenInfo(T);I.access_token=e.access_token}const s=await y.getIdcard(I);if(u.dataObj=s,L(),s&&0===s.words_result_num&&"normal"!=s.image_status){return void h({message:{reversed_side:"身份证正反面颠倒",non_idcard:"上传的图片中不包含身份证",blurred:"身份证模糊",other_type_card:"其他类型证照",over_exposure:"身份证关键字段反光或过曝",over_dark:"身份证欠曝（亮度过低）",unknown:"识别失败，请重新上传"}[s.image_status]||"识别失败，请重新上传",duration:3e3,position:"top"})}if(s&&!s.words_result_num)return void h({message:"识别失败，请重新上传",duration:3e3,position:"top"});let a=[];for(const o in s.words_result)if(Object.prototype.hasOwnProperty.call(s.words_result,o)){const e=s.words_result[o];a.push({label:o,value:e.words})}u.infoList=a},E=e=>{let t=e.content;q("front",t)},G=e=>{let t=e.content;q("back",t)},J=async()=>{var e,t,s,a,o,i;if(0==u.dataObj.words_result_num)return void h("身份证验证失败");if(!I.access_token){const e=await y.getAccessTokenInfo(T);I.access_token=e.access_token}let n={plan_id:"17266",access_token:I.access_token};let r=(await y.generate(n)).result.verify_token,d={verify_token:r,id_name:null==(s=null==(t=null==(e=u.dataObj)?void 0:e.words_result)?void 0:t.姓名)?void 0:s.words,id_no:null==(i=null==(o=null==(a=u.dataObj)?void 0:a.words_result)?void 0:o.公民身份号码)?void 0:i.words};I.access_token;(await y.faceprint(d)).success?window.location.href=`https://brain.baidu.com/face/print/?token=${r}&successUrl=${encodeURIComponent(u.url)}&failedUrl=${encodeURIComponent(u.url+"/#/identityCard")}`:h("验证失败")};return(e,t)=>{const s=g,l=b,c=x,y=j;return f(),a("div",z,[o("div",$,[C,i(l,{justify:"center",class:"mt"},{default:n((()=>[i(s,{modelValue:u.fileListzm,"onUpdate:modelValue":t[0]||(t[0]=e=>u.fileListzm=e),"after-read":E,"preview-size":["300px","200px"],multiple:"","max-count":1,"upload-text":"身份证正面"},{default:n((()=>[m(o("img",O,null,512),[[p,!(u.fileListzm&&u.fileListzm.length)]])])),_:1},8,["modelValue"])])),_:1})]),o("div",U,[V,i(l,{justify:"center",class:"mt"},{default:n((()=>[i(s,{modelValue:u.fileListfm,"onUpdate:modelValue":t[1]||(t[1]=e=>u.fileListfm=e),"after-read":G,"preview-size":["300px","200px"],capture:"camera",multiple:"","max-count":1,"upload-text":"身份证反面"},{default:n((()=>[m(o("img",A,null,512),[[p,!(u.fileListfm&&u.fileListfm.length)]])])),_:1},8,["modelValue"])])),_:1}),(f(!0),a(r,null,d(u.infoList,(e=>(f(),_(l,null,{default:n((()=>[i(c,{span:"24"},{default:n((()=>[w(v(`${e.label} : ${e.value}`),1)])),_:2},1024)])),_:2},1024)))),256))]),i(y,{type:"primary",onClick:J},{default:n((()=>[P])),_:1})])}}}),[["__scopeId","data-v-64eeab88"]]);export{R as default};
