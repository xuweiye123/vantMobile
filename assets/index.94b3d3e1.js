import{d as e,j as a,n as t,h as r,g as l,i as s,A as n,o,D as i,p as u,m as c,y as d,a as m,O as g,B as p,c as f,q as v,w as h,b,e as y,f as w,s as x,t as k,M as V}from"./index.a2cd37f0.js";import{c as S,C as B}from"./index.21394cc0.js";import{b as C,p as M,f as A,s as T,r as I,h as P,u as j}from"./useLoading.45bc7674.js";import{c as E,n as L,t as $,w as _,x as F,o as z,k as W,m as q,d as O,e as D,u as H,a as U,i as K,y as G,I as J,j as N,_ as Q}from"./plugin-vueexport-helper.fc4dd177.js";import{u as R,F as X,b as Y,C as Z}from"./constant.5aba24a5.js";import{B as ee}from"./index.51977569.js";import"./use-route.3549be32.js";const[ae,te]=E("form");const re=_(e({name:ae,props:{colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:L,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:$,showErrorMessage:$,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}},emits:["submit","failed"],setup(e,{emit:t,slots:r}){const{children:l,linkChildren:s}=R(X),n=e=>e?l.filter((a=>e.includes(a.name))):l,o=a=>{return"string"==typeof a?(e=>{const a=l.find((a=>a.name===e));return a?new Promise(((e,t)=>{a.validate().then((a=>{a?t(a):e()}))})):Promise.reject()})(a):e.validateFirst?(t=a,new Promise(((e,a)=>{const r=[];n(t).reduce(((e,a)=>e.then((()=>{if(!r.length)return a.validate().then((e=>{e&&r.push(e)}))}))),Promise.resolve()).then((()=>{r.length?a(r):e()}))}))):(e=>new Promise(((a,t)=>{const r=n(e);Promise.all(r.map((e=>e.validate()))).then((e=>{(e=e.filter(Boolean)).length?t(e):a()}))})))(a);var t},i=(e,a)=>{l.some((t=>t.name===e&&(t.$el.scrollIntoView(a),!0)))},u=()=>l.reduce(((e,a)=>(e[a.name]=a.formValue.value,e)),{}),c=()=>{const a=u();o().then((()=>t("submit",a))).catch((r=>{t("failed",{values:a,errors:r}),e.scrollToError&&r[0].name&&i(r[0].name)}))},d=e=>{M(e),c()};return s({props:e}),C({submit:c,validate:o,getValues:u,scrollToField:i,resetValidation:e=>{"string"==typeof e&&(e=[e]);n(e).forEach((e=>{e.resetValidation()}))},getValidationStatus:()=>l.reduce(((e,a)=>(e[a.name]=a.getValidationStatus(),e)),{})}),()=>{var e;return a("form",{class:te(),onSubmit:d},[null==(e=r.default)?void 0:e.call(r)])}}}));function le(e,a){return(!a.required||!function(e){return Array.isArray(e)?!e.length:0!==e&&!e}(e))&&!(a.pattern&&!a.pattern.test(String(e)))}function se(e,a){const{message:t}=a;return W(t)?t(e,a):t||""}function ne({target:e}){e.composing=!0}function oe({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function ie(e){return[...e].length}let ue=0;const[ce,de]=E("field");const me=_(e({name:ce,props:D({},S,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:L,formatter:Function,clearIcon:q("clear"),modelValue:O(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:q("focus"),formatTrigger:q("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:L,type:q("text"),rules:Array,autosize:[Boolean,Object],labelWidth:L,labelClass:H,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","click-input","end-validate","start-validate","click-left-icon","click-right-icon","update:modelValue"],setup(e,{emit:m,slots:g}){const p=function(){const e=t(),{name:a="unknown"}=(null==e?void 0:e.type)||{};return`${a}-${++ue}`}(),f=r({status:"unvalidated",focused:!1,validateMessage:""}),v=l(),h=l(),{parent:b}=Y(X),y=()=>{var a;return String(null!=(a=e.modelValue)?a:"")},w=a=>K(e[a])?e[a]:b&&K(b.props[a])?b.props[a]:void 0,x=s((()=>{const a=w("readonly");if(e.clearable&&!a){const a=""!==y(),t="always"===e.clearTrigger||"focus"===e.clearTrigger&&f.focused;return a&&t}return!1})),k=s((()=>h.value&&g.input?h.value():e.modelValue)),V=e=>e.reduce(((e,a)=>e.then((()=>{if("failed"===f.status)return;let{value:e}=k;return a.formatter&&(e=a.formatter(e,a)),le(e,a)?a.validator?function(e,a){return new Promise((t=>{const r=a.validator(e,a);z(r)?r.then(t):t(r)}))}(e,a).then((t=>{t&&"string"==typeof t?(f.status="failed",f.validateMessage=t):!1===t&&(f.status="failed",f.validateMessage=se(e,a))})):void 0:(f.status="failed",void(f.validateMessage=se(e,a)))}))),Promise.resolve()),S=()=>{f.status="unvalidated",f.validateMessage=""},P=()=>m("end-validate",{status:f.status}),j=(a=e.rules)=>new Promise((t=>{S(),a?(m("start-validate"),V(a).then((()=>{"failed"===f.status?(t({name:e.name,message:f.validateMessage}),P()):(f.status="passed",t(),P())}))):t()})),E=a=>{if(b&&e.rules){const{validateTrigger:t}=b.props,r=N(t).includes(a),l=e.rules.filter((e=>e.trigger?N(e.trigger).includes(a):r));l.length&&j(l)}},L=(a,t="onChange")=>{if(a=(a=>{const{maxlength:t}=e;if(K(t)&&ie(a)>t){const e=y();return e&&ie(e)===+t?e:function(e,a){return[...e].slice(0,a).join("")}(a,+t)}return a})(a),"number"===e.type||"digit"===e.type){const t="number"===e.type;a=G(a,t,t)}e.formatter&&t===e.formatTrigger&&(a=e.formatter(a)),v.value&&v.value.value!==a&&(v.value.value=a),a!==e.modelValue&&m("update:modelValue",a)},$=e=>{e.target.composing||L(e.target.value)},_=()=>{var e;return null==(e=v.value)?void 0:e.blur()},W=()=>{const a=v.value;"textarea"===e.type&&e.autosize&&a&&function(e,a){const t=A();e.style.height="auto";let r=e.scrollHeight;if(F(a)){const{maxHeight:e,minHeight:t}=a;void 0!==e&&(r=Math.min(r,e)),void 0!==t&&(r=Math.max(r,t))}r&&(e.style.height=`${r}px`,T(t))}(a,e.autosize)},q=e=>{f.focused=!0,m("focus",e),i(W),w("readonly")&&_()},O=e=>{w("readonly")||(f.focused=!1,L(y(),"onBlur"),m("blur",e),E("onBlur"),i(W),I())},D=e=>m("click-input",e),H=e=>m("click-left-icon",e),Q=e=>m("click-right-icon",e),R=e=>{M(e),m("update:modelValue",""),m("clear",e)},ee=s((()=>"boolean"==typeof e.error?e.error:!(!b||!b.props.showError||"failed"!==f.status)||void 0)),ae=s((()=>{const e=w("labelWidth");if(e)return{width:U(e)}})),te=a=>{if(13===a.keyCode){b&&b.props.submitOnEnter||"textarea"===e.type||M(a),"search"===e.type&&_()}m("keypress",a)},re=()=>e.id||`${p}-input`,ce=()=>{const t=de("control",[w("inputAlign"),{error:ee.value,custom:!!g.input,"min-height":"textarea"===e.type&&!e.autosize}]);if(g.input)return a("div",{class:t,onClick:D},[g.input()]);const r={id:re(),ref:v,name:e.name,rows:void 0!==e.rows?+e.rows:void 0,class:t,disabled:w("disabled"),readonly:w("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${p}-label`:void 0,onBlur:O,onFocus:q,onInput:$,onClick:D,onChange:oe,onKeypress:te,onCompositionend:oe,onCompositionstart:ne};return"textarea"===e.type?a("textarea",r,null):a("input",c("number"===(l=e.type)?{type:"text",inputmode:"decimal"}:"digit"===l?{type:"tel",inputmode:"numeric"}:{type:l},r),null);var l},me=()=>{const t=g["right-icon"];if(e.rightIcon||t)return a("div",{class:de("right-icon"),onClick:Q},[t?t():a(J,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},ge=()=>{if(e.showWordLimit&&e.maxlength){const t=ie(y());return a("div",{class:de("word-limit")},[a("span",{class:de("word-num")},[t]),d("/"),e.maxlength])}},pe=()=>{if(b&&!1===b.props.showErrorMessage)return;const t=e.errorMessage||f.validateMessage;if(t){const e=g["error-message"],r=w("errorMessageAlign");return a("div",{class:de("error-message",r)},[e?e({message:t}):t])}},fe=()=>[a("div",{class:de("body")},[ce(),x.value&&a(J,{name:e.clearIcon,class:de("clear"),onTouchstart:R},null),me(),g.button&&a("div",{class:de("button")},[g.button()])]),ge(),pe()];return C({blur:_,focus:()=>{var e;return null==(e=v.value)?void 0:e.focus()},validate:j,formValue:k,resetValidation:S,getValidationStatus:()=>f.status}),u(Z,{customValue:h,resetValidation:S,validateWithTrigger:E}),n((()=>e.modelValue),(()=>{L(y()),S(),E("onChange"),i(W)})),o((()=>{L(y(),e.formatTrigger),i(W)})),()=>{const t=w("disabled"),r=w("labelAlign"),l=(()=>{const t=w("colon")?":":"";return g.label?[g.label(),t]:e.label?a("label",{id:`${p}-label`,for:re()},[e.label+t]):void 0})(),s=(()=>{const t=g["left-icon"];if(e.leftIcon||t)return a("div",{class:de("left-icon"),onClick:H},[t?t():a(J,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return a(B,{size:e.size,icon:e.leftIcon,class:de({error:ee.value,disabled:t,[`label-${r}`]:r}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:ae.value,valueClass:de("value"),titleClass:[de("label",[r,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:s?()=>s:null,title:l?()=>l:null,value:fe,extra:g.extra})}}})),ge={login:async e=>await P.post("/user/login",e)},pe={class:"login"},fe={class:"content"},ve=(e=>(x("data-v-9b118154"),e=e(),k(),e))((()=>v("div",{class:"logo"},[v("img",{src:"/vantMobile/assets/vue.5532db34.svg",alt:"logo"})],-1))),he=d("Login "),be=Q(e({__name:"index",setup(e){const t=V(),s=b(),{startLoading:n,stopLoading:i}=j(),u=l("password"),c=l(!1),d=r({username:"",password:""});o((()=>{m.config(s.query.debug),g.enable()})),p((()=>{g.disable()}));const x=()=>{c.value=!c.value,u.value=c.value?"text":"password"},k=async()=>{setTimeout((()=>{t.push("/index")}),3e3),n(),await ge.login(d),i(),t.push("/index")},S=(e={})=>{};return(e,t)=>{const r=me,l=J,s=ee,n=re;return y(),f("div",pe,[v("div",fe,[ve,a(n,{onSubmit:k,onFailed:S},{default:h((()=>[a(r,{modelValue:d.username,"onUpdate:modelValue":t[0]||(t[0]=e=>d.username=e),modelModifiers:{trim:!0},name:"username",clearable:"",placeholder:"input username"},null,8,["modelValue"]),a(r,{modelValue:d.password,"onUpdate:modelValue":t[1]||(t[1]=e=>d.password=e),type:u.value,name:"password",clearable:"",placeholder:"input password"},{button:h((()=>[v("div",{onClick:x},[c.value?(y(),w(l,{key:0,name:"eye-o"})):(y(),w(l,{key:1,name:"closed-eye"}))])])),_:1},8,["modelValue","type"]),a(s,{block:"",type:"primary","native-type":"submit",class:"submit-btn"},{default:h((()=>[he])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-9b118154"]]);export{be as default};
